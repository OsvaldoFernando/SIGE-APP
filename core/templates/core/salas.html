{% extends 'core/base.html' %}
{% block content %}
<div class="page-header bg-white py-4 mb-4 border-bottom sticky-top" style="z-index: 1000;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a href="{% url 'painel_principal' %}" class="text-decoration-none">Painel</a></li>
                        <li class="breadcrumb-item active">Gestão de Salas</li>
                    </ol>
                </nav>
                <h2 class="fw-bold mb-0" style="color: #0f172a;">Salas & <span class="text-primary">Laboratórios</span></h2>
            </div>
            <div class="col-lg-6 text-lg-end mt-3 mt-lg-0">
                {% if salas %}
                <button class="btn btn-primary px-4 fw-bold shadow-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#modalAddSala">
                    <i class="bi bi-plus-lg me-2"></i>Nova Sala
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="container pb-5">
    <div class="row g-4">
        {% for sala in salas %}
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-4 h-100 transition-hover">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="bg-{% if sala.tipo == 'laboratorio' %}info{% else %}primary{% endif %} bg-opacity-10 p-3 rounded-4">
                            <i class="bi bi-{% if sala.tipo == 'laboratorio' %}pc-display-horizontal{% else %}door-open-fill{% endif %} fs-4 text-{% if sala.tipo == 'laboratorio' %}info{% else %}primary{% endif %}"></i>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-link text-muted p-0" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end border-0 shadow-sm rounded-3">
                                <li>
                                    <button class="dropdown-item py-2" data-bs-toggle="modal" data-bs-target="#modalEditSala{{ sala.id }}">
                                        <i class="bi bi-pencil me-2 text-primary"></i>Editar
                                    </button>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <button class="dropdown-item py-2 text-danger" data-bs-toggle="modal" data-bs-target="#modalDeleteSala{{ sala.id }}">
                                        <i class="bi bi-trash3 me-2"></i>Eliminar
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <h5 class="fw-bold mb-1">{{ sala.nome }}</h5>
                    <div class="d-flex gap-2 mb-3">
                        <span class="badge bg-light text-muted border fw-medium">{{ sala.get_tipo_display }}</span>
                        {% if sala.ativa %}
                        <span class="badge bg-success bg-opacity-10 text-success border-0 fw-bold">Ativa</span>
                        {% else %}
                        <span class="badge bg-danger bg-opacity-10 text-danger border-0 fw-bold">Inativa</span>
                        {% endif %}
                    </div>
                    
                    <div class="p-3 bg-light rounded-4 d-flex align-items-center">
                        <i class="bi bi-people-fill text-muted me-3 fs-5"></i>
                        <div>
                            <small class="text-muted d-block fw-bold" style="font-size: 0.65rem;">CAPACIDADE</small>
                            <span class="fw-bold">{{ sala.capacidade }} Estudantes</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar -->
        <div class="modal fade" id="modalEditSala{{ sala.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold">Editar Sala</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="edit_sala" value="1">
                        <input type="hidden" name="sala_id" value="{{ sala.id }}">
                        <div class="modal-body p-4">
                            <div class="mb-3">
                                <label class="form-label small fw-bold">Nome da Sala</label>
                                <input type="text" name="nome" class="form-control" value="{{ sala.nome }}" required>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Capacidade</label>
                                    <input type="number" name="capacidade" class="form-control" value="{{ sala.capacidade }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Tipo</label>
                                    <select name="tipo" class="form-select">
                                        <option value="normal" {% if sala.tipo == 'normal' %}selected{% endif %}>Normal</option>
                                        <option value="laboratorio" {% if sala.tipo == 'laboratorio' %}selected{% endif %}>Laboratório</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" name="ativa" {% if sala.ativa %}checked{% endif %}>
                                    <label class="form-check-label fw-bold">Sala Ativa</label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 pt-0">
                            <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold">Guardar Alterações</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Eliminar -->
        <div class="modal fade" id="modalDeleteSala{{ sala.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content border-0 shadow-lg rounded-4 text-center">
                    <div class="modal-body p-4">
                        <div class="text-danger mb-3">
                            <i class="bi bi-exclamation-octagon-fill display-4"></i>
                        </div>
                        <h5 class="fw-bold">Remover Sala?</h5>
                        <p class="text-muted small">Tem certeza que deseja remover a sala <strong>{{ sala.nome }}</strong>? Esta ação não pode ser desfeita.</p>
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="delete_sala" value="1">
                            <input type="hidden" name="sala_id" value="{{ sala.id }}">
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-danger rounded-pill fw-bold">Sim, Remover</button>
                                <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="p-5 bg-white shadow-sm rounded-4 d-inline-block" style="max-width: 400px;">
                <i class="bi bi-door-closed display-1 text-muted opacity-25 mb-4"></i>
                <h4 class="fw-bold">Nenhuma Sala</h4>
                <p class="text-muted">Comece a cadastrar as salas e laboratórios da instituição.</p>
                <button class="btn btn-primary rounded-pill px-4 fw-bold" data-bs-toggle="modal" data-bs-target="#modalAddSala">
                    Cadastrar Primeira Sala
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Modal Adicionar -->
<div class="modal fade" id="modalAddSala" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Nova Sala</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="add_sala" value="1">
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Nome da Sala</label>
                        <input type="text" name="nome" class="form-control" placeholder="Ex: A1 ou Laboratório 2" required>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Capacidade</label>
                            <input type="number" name="capacidade" class="form-control" placeholder="30" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Tipo</label>
                            <select name="tipo" class="form-select">
                                <option value="normal">Normal</option>
                                <option value="laboratorio">Laboratório</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="ativa" checked>
                            <label class="form-check-label fw-bold">Sala Ativa</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm">Cadastrar Sala</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.transition-hover { transition: all 0.3s ease; }
.transition-hover:hover { transform: translateY(-5px); }
</style>
{% endblock %}
